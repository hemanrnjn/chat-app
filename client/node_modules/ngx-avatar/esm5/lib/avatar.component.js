/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ElementRef } from "@angular/core";
import { AsyncSource } from "./sources/async-source";
import { SourceFactory } from "./sources/source.factory";
import { AvatarService } from "./avatar.service";
import { AvatarSource } from "./sources/avatar-source.enum";
/**
 * Universal avatar component that
 * generates avatar from different sources
 *
 * export
 * class AvatarComponent
 * implements {OnChanges}
 */
var AvatarComponent = /** @class */ (function () {
    function AvatarComponent(elementRef, sourceFactory, avatarService) {
        this.elementRef = elementRef;
        this.sourceFactory = sourceFactory;
        this.avatarService = avatarService;
        this.round = true;
        this.size = 50;
        this.textSizeRatio = 3;
        this.fgColor = "#FFF";
        this.style = {};
        this.cornerRadius = 0;
        this.clickOnAvatar = new EventEmitter();
        this.avatarStyle = {};
        this.hostStyle = {};
        this._currentSource = 0;
        this._sources = Array();
    }
    // handle click event
    // handle click event
    /**
     * @param {?} event
     * @return {?}
     */
    AvatarComponent.prototype.handleClickEvent = 
    // handle click event
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event) {
            this.clickOnAvatar.emit(this._sources[this._currentSource - 1]);
        }
    };
    /**
     * Detect inputs change
     *
     * param {{ [propKey: string]: SimpleChange }} changes
     *
     * memberof AvatarComponent
     */
    /**
     * Detect inputs change
     *
     * param {{ [propKey: string]: SimpleChange }} changes
     *
     * memberof AvatarComponent
     * @param {?} changes
     * @return {?}
     */
    AvatarComponent.prototype.ngOnChanges = /**
     * Detect inputs change
     *
     * param {{ [propKey: string]: SimpleChange }} changes
     *
     * memberof AvatarComponent
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        for (var propName in changes) {
            if (this.avatarService.isSource(propName)) {
                /** @type {?} */
                var currentValue = changes[propName].currentValue;
                this._addSource(AvatarSource[propName.toUpperCase()], currentValue);
            }
        }
        // reintialize the avatar component when a source property value has changed
        // the fallback system must be re-invoked with the new values.
        this._initializeAvatar();
    };
    /**
     * Initialize the avatar component and its fallback system
     */
    /**
     * Initialize the avatar component and its fallback system
     * @return {?}
     */
    AvatarComponent.prototype._initializeAvatar = /**
     * Initialize the avatar component and its fallback system
     * @return {?}
     */
    function () {
        var _this = this;
        this._currentSource = 0;
        if (this._sources.length > 0 && this._sources[this._currentSource]) {
            // Order sources array by source priority
            this._sources.sort(function (source1, source2) { return _this.avatarService.copmareSources(source1.sourceType, source2.sourceType); });
            // Host style
            this.hostStyle = {
                width: this.size + "px",
                height: this.size + "px"
            };
            // Fetch avatar source
            this.fetch();
        }
    };
    /**
     * Fetch avatar source
     *
     * param {any} event
     *
     * memberOf AvatarComponent
     */
    /**
     * Fetch avatar source
     *
     * param {any} event
     *
     * memberOf AvatarComponent
     * @param {?=} event
     * @return {?}
     */
    AvatarComponent.prototype.fetch = /**
     * Fetch avatar source
     *
     * param {any} event
     *
     * memberOf AvatarComponent
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var avatarSource = this._sources[this._currentSource];
        if (!avatarSource) {
            return false;
        }
        if (this.avatarService.isTextAvatar(avatarSource.sourceType)) {
            this.data = avatarSource.getAvatar(this.initialsSize);
            this.src = undefined;
            this.avatarStyle = this._initialsStyle(avatarSource.sourceId);
        }
        else {
            this.avatarStyle = this._imageStyle();
            if (avatarSource instanceof AsyncSource) {
                this._fetchAsyncAvatar(avatarSource);
            }
            else {
                this.src = avatarSource.getAvatar(this.size);
            }
        }
        this._currentSource++;
    };
    /**
     *
     * returns initials style
     *
     * memberOf AvatarComponent
     */
    /**
     *
     * returns initials style
     *
     * memberOf AvatarComponent
     * @param {?} avatarValue
     * @return {?}
     */
    AvatarComponent.prototype._initialsStyle = /**
     *
     * returns initials style
     *
     * memberOf AvatarComponent
     * @param {?} avatarValue
     * @return {?}
     */
    function (avatarValue) {
        return tslib_1.__assign({ textAlign: "center", borderRadius: this.round ? "100%" : this.cornerRadius + "px", border: this.borderColor ? "1px solid " + this.borderColor : "", textTransform: "uppercase", color: this.fgColor, backgroundColor: this.bgColor
                ? this.bgColor
                : this.avatarService.getRandomColor(avatarValue), font: Math.floor(this.size / this.textSizeRatio) +
                "px Helvetica, Arial, sans-serif", lineHeight: this.size + "px" }, this.style);
    };
    /**
     *
     * returns image style
     *
     * memberOf AvatarComponent
     */
    /**
     *
     * returns image style
     *
     * memberOf AvatarComponent
     * @return {?}
     */
    AvatarComponent.prototype._imageStyle = /**
     *
     * returns image style
     *
     * memberOf AvatarComponent
     * @return {?}
     */
    function () {
        return tslib_1.__assign({ maxWidth: "100%", borderRadius: this.round ? "50%" : this.cornerRadius + "px", border: this.borderColor ? "1px solid " + this.borderColor : "", width: this.size, height: this.size }, this.style);
    };
    /**
     * Fetch avatar image asynchrounsly.
     *
     * param {Source} source represents avatar source
     * memberof AvatarComponent
     */
    /**
     * Fetch avatar image asynchrounsly.
     *
     * param {Source} source represents avatar source
     * memberof AvatarComponent
     * @param {?} source
     * @return {?}
     */
    AvatarComponent.prototype._fetchAsyncAvatar = /**
     * Fetch avatar image asynchrounsly.
     *
     * param {Source} source represents avatar source
     * memberof AvatarComponent
     * @param {?} source
     * @return {?}
     */
    function (source) {
        var _this = this;
        this.avatarService.fetchAvatar(source.getAvatar()).subscribe(function (data) {
            // extract avatar image from the response data
            _this.src = source.processResponse(data, _this.size);
        }, function (err) {
            console.error("ngx-avatar: error while fetching " + source.sourceType + " avatar ");
        });
    };
    /**
     * Add avatar source
     *
     * param sourceType avatar source type e.g facebook,twitter, etc.
     * param sourceValue  source value e.g facebookId value, etc.
     */
    /**
     * Add avatar source
     *
     * param sourceType avatar source type e.g facebook,twitter, etc.
     * param sourceValue  source value e.g facebookId value, etc.
     * @param {?} sourceType
     * @param {?} sourceValue
     * @return {?}
     */
    AvatarComponent.prototype._addSource = /**
     * Add avatar source
     *
     * param sourceType avatar source type e.g facebook,twitter, etc.
     * param sourceValue  source value e.g facebookId value, etc.
     * @param {?} sourceType
     * @param {?} sourceValue
     * @return {?}
     */
    function (sourceType, sourceValue) {
        if (sourceValue) {
            if (!this._updateExistingSource(sourceType, sourceValue)) {
                this._sources.push(this.sourceFactory.newInstance(sourceType, sourceValue));
            }
        }
    };
    /**
     * This method check wether an avatar source has been added. If so
     * the source value will be updated with the new value passed as
     * paramater.
     * It returns true if the source exists and update has been performed,
     * returns false if the source was not found
     *
     * param {string} sourceType the type of the source
     * param {string} sourceValue the new value of the source
     *
     * memberof AvatarComponent
     */
    /**
     * This method check wether an avatar source has been added. If so
     * the source value will be updated with the new value passed as
     * paramater.
     * It returns true if the source exists and update has been performed,
     * returns false if the source was not found
     *
     * param {string} sourceType the type of the source
     * param {string} sourceValue the new value of the source
     *
     * memberof AvatarComponent
     * @param {?} sourceType
     * @param {?} sourceValue
     * @return {?}
     */
    AvatarComponent.prototype._updateExistingSource = /**
     * This method check wether an avatar source has been added. If so
     * the source value will be updated with the new value passed as
     * paramater.
     * It returns true if the source exists and update has been performed,
     * returns false if the source was not found
     *
     * param {string} sourceType the type of the source
     * param {string} sourceValue the new value of the source
     *
     * memberof AvatarComponent
     * @param {?} sourceType
     * @param {?} sourceValue
     * @return {?}
     */
    function (sourceType, sourceValue) {
        /** @type {?} */
        var sourceIndex = this._sources.findIndex(function (source) { return source.sourceType === sourceType.toUpperCase(); });
        if (sourceIndex > -1) {
            this._sources[sourceIndex].sourceId = sourceValue;
            return true;
        }
        return false;
    };
    AvatarComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: "ngx-avatar",
                    template: "\n    <div (click)=\"handleClickEvent($event)\" class=\"avatar-container\" [ngStyle]=\"hostStyle\">\n    <img *ngIf=\"src\"\n      [src]=\"src\"\n      [width]=\"size\"\n      [height]=\"size\"\n      [ngStyle]=\"avatarStyle\"\n      (error)=\"fetch($event)\"\n      class=\"avatar-content\"\n     />\n\n   <div *ngIf=\"data && !src\"\n     [ngStyle]=\"avatarStyle\"\n     class=\"avatar-content\">{{data}}</div>\n   </div>",
                    styles: ["\n      :host {\n        border-radius: \"50%\";\n      }\n    "]
                }] }
    ];
    /** @nocollapse */
    AvatarComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: SourceFactory },
        { type: AvatarService }
    ]; };
    AvatarComponent.propDecorators = {
        round: [{ type: Input }],
        size: [{ type: Input }],
        textSizeRatio: [{ type: Input }],
        bgColor: [{ type: Input }],
        fgColor: [{ type: Input }],
        borderColor: [{ type: Input }],
        style: [{ type: Input }],
        cornerRadius: [{ type: Input }],
        facebook: [{ type: Input, args: ["facebookId",] }],
        twitter: [{ type: Input, args: ["twitterId",] }],
        google: [{ type: Input, args: ["googleId",] }],
        vkontakte: [{ type: Input, args: ["vkontakteId",] }],
        skype: [{ type: Input, args: ["skypeId",] }],
        gravatar: [{ type: Input, args: ["gravatarId",] }],
        github: [{ type: Input, args: ["githubId",] }],
        custom: [{ type: Input, args: ["src",] }],
        initials: [{ type: Input, args: ["name",] }],
        value: [{ type: Input, args: ["value",] }],
        placeholder: [{ type: Input, args: ["placeholder",] }],
        initialsSize: [{ type: Input, args: ["initialsSize",] }],
        clickOnAvatar: [{ type: Output }]
    };
    return AvatarComponent;
}());
export { AvatarComponent };
if (false) {
    /** @type {?} */
    AvatarComponent.prototype.round;
    /** @type {?} */
    AvatarComponent.prototype.size;
    /** @type {?} */
    AvatarComponent.prototype.textSizeRatio;
    /** @type {?} */
    AvatarComponent.prototype.bgColor;
    /** @type {?} */
    AvatarComponent.prototype.fgColor;
    /** @type {?} */
    AvatarComponent.prototype.borderColor;
    /** @type {?} */
    AvatarComponent.prototype.style;
    /** @type {?} */
    AvatarComponent.prototype.cornerRadius;
    /** @type {?} */
    AvatarComponent.prototype.facebook;
    /** @type {?} */
    AvatarComponent.prototype.twitter;
    /** @type {?} */
    AvatarComponent.prototype.google;
    /** @type {?} */
    AvatarComponent.prototype.vkontakte;
    /** @type {?} */
    AvatarComponent.prototype.skype;
    /** @type {?} */
    AvatarComponent.prototype.gravatar;
    /** @type {?} */
    AvatarComponent.prototype.github;
    /** @type {?} */
    AvatarComponent.prototype.custom;
    /** @type {?} */
    AvatarComponent.prototype.initials;
    /** @type {?} */
    AvatarComponent.prototype.value;
    /** @type {?} */
    AvatarComponent.prototype.placeholder;
    /** @type {?} */
    AvatarComponent.prototype.initialsSize;
    /** @type {?} */
    AvatarComponent.prototype.clickOnAvatar;
    /** @type {?} */
    AvatarComponent.prototype.src;
    /** @type {?} */
    AvatarComponent.prototype.data;
    /** @type {?} */
    AvatarComponent.prototype.avatarStyle;
    /** @type {?} */
    AvatarComponent.prototype.hostStyle;
    /** @type {?} */
    AvatarComponent.prototype._currentSource;
    /** @type {?} */
    AvatarComponent.prototype._sources;
    /** @type {?} */
    AvatarComponent.prototype.elementRef;
    /** @type {?} */
    AvatarComponent.prototype.sourceFactory;
    /** @type {?} */
    AvatarComponent.prototype.avatarService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZhdGFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1hdmF0YXIvIiwic291cmNlcyI6WyJsaWIvYXZhdGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osVUFBVSxFQUdYLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDekQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQzs7Ozs7Ozs7O0FBVzVEO0lBZ0ZFLHlCQUNTLFVBQXNCLEVBQ3RCLGFBQTRCLEVBQzNCLGFBQTRCO1FBRjdCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDM0Isa0JBQWEsR0FBYixhQUFhLENBQWU7UUF2RHRDLFVBQUssR0FBWSxJQUFJLENBQUM7UUFFdEIsU0FBSSxHQUFXLEVBQUUsQ0FBQztRQUVsQixrQkFBYSxHQUFXLENBQUMsQ0FBQztRQUkxQixZQUFPLEdBQUcsTUFBTSxDQUFDO1FBSWpCLFVBQUssR0FBUSxFQUFFLENBQUM7UUFFaEIsaUJBQVksR0FBRyxDQUFDLENBQUM7UUEwQmpCLGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFNcEQsZ0JBQVcsR0FBUSxFQUFFLENBQUM7UUFDdEIsY0FBUyxHQUFRLEVBQUUsQ0FBQztRQUVuQixtQkFBYyxHQUFHLENBQUMsQ0FBQztRQUNuQixhQUFRLEdBQWEsS0FBSyxFQUFFLENBQUM7SUFNakMsQ0FBQztJQUVMLHFCQUFxQjs7Ozs7O0lBQ3JCLDBDQUFnQjs7Ozs7O0lBQWhCLFVBQWlCLEtBQVU7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QkFBb0I7O0lBQ3BCLHNDQUE2Qjs7SUFDN0Isb0NBQTJCOztJQUUzQix5Q0FBMkI7O0lBQzNCLG1DQUFxQzs7SUFHbkMscUNBQTZCOztJQUM3Qix3Q0FBbUM7O0lBQ25DLHdDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBFbGVtZW50UmVmLFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZVxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBTb3VyY2UgfSBmcm9tIFwiLi9zb3VyY2VzL3NvdXJjZVwiO1xuaW1wb3J0IHsgQXN5bmNTb3VyY2UgfSBmcm9tIFwiLi9zb3VyY2VzL2FzeW5jLXNvdXJjZVwiO1xuaW1wb3J0IHsgU291cmNlRmFjdG9yeSB9IGZyb20gXCIuL3NvdXJjZXMvc291cmNlLmZhY3RvcnlcIjtcbmltcG9ydCB7IEF2YXRhclNlcnZpY2UgfSBmcm9tIFwiLi9hdmF0YXIuc2VydmljZVwiO1xuaW1wb3J0IHsgQXZhdGFyU291cmNlIH0gZnJvbSBcIi4vc291cmNlcy9hdmF0YXItc291cmNlLmVudW1cIjtcblxuLyoqXG4gKiBVbml2ZXJzYWwgYXZhdGFyIGNvbXBvbmVudCB0aGF0XG4gKiBnZW5lcmF0ZXMgYXZhdGFyIGZyb20gZGlmZmVyZW50IHNvdXJjZXNcbiAqXG4gKiBleHBvcnRcbiAqIGNsYXNzIEF2YXRhckNvbXBvbmVudFxuICogaW1wbGVtZW50cyB7T25DaGFuZ2VzfVxuICovXG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiBcIm5neC1hdmF0YXJcIixcbiAgc3R5bGVzOiBbXG4gICAgYFxuICAgICAgOmhvc3Qge1xuICAgICAgICBib3JkZXItcmFkaXVzOiBcIjUwJVwiO1xuICAgICAgfVxuICAgIGBcbiAgXSxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IChjbGljayk9XCJoYW5kbGVDbGlja0V2ZW50KCRldmVudClcIiBjbGFzcz1cImF2YXRhci1jb250YWluZXJcIiBbbmdTdHlsZV09XCJob3N0U3R5bGVcIj5cbiAgICA8aW1nICpuZ0lmPVwic3JjXCJcbiAgICAgIFtzcmNdPVwic3JjXCJcbiAgICAgIFt3aWR0aF09XCJzaXplXCJcbiAgICAgIFtoZWlnaHRdPVwic2l6ZVwiXG4gICAgICBbbmdTdHlsZV09XCJhdmF0YXJTdHlsZVwiXG4gICAgICAoZXJyb3IpPVwiZmV0Y2goJGV2ZW50KVwiXG4gICAgICBjbGFzcz1cImF2YXRhci1jb250ZW50XCJcbiAgICAgLz5cblxuICAgPGRpdiAqbmdJZj1cImRhdGEgJiYgIXNyY1wiXG4gICAgIFtuZ1N0eWxlXT1cImF2YXRhclN0eWxlXCJcbiAgICAgY2xhc3M9XCJhdmF0YXItY29udGVudFwiPnt7ZGF0YX19PC9kaXY+XG4gICA8L2Rpdj5gXG59KVxuZXhwb3J0IGNsYXNzIEF2YXRhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpXG4gIHJvdW5kOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KClcbiAgc2l6ZTogbnVtYmVyID0gNTA7XG4gIEBJbnB1dCgpXG4gIHRleHRTaXplUmF0aW86IG51bWJlciA9IDM7XG4gIEBJbnB1dCgpXG4gIGJnQ29sb3I6IHN0cmluZztcbiAgQElucHV0KClcbiAgZmdDb2xvciA9IFwiI0ZGRlwiO1xuICBASW5wdXQoKVxuICBib3JkZXJDb2xvcjogc3RyaW5nO1xuICBASW5wdXQoKVxuICBzdHlsZTogYW55ID0ge307XG4gIEBJbnB1dCgpXG4gIGNvcm5lclJhZGl1cyA9IDA7XG4gIEBJbnB1dChcImZhY2Vib29rSWRcIilcbiAgZmFjZWJvb2s6IHN0cmluZztcbiAgQElucHV0KFwidHdpdHRlcklkXCIpXG4gIHR3aXR0ZXI6IHN0cmluZztcbiAgQElucHV0KFwiZ29vZ2xlSWRcIilcbiAgZ29vZ2xlOiBzdHJpbmc7XG4gIEBJbnB1dChcInZrb250YWt0ZUlkXCIpXG4gIHZrb250YWt0ZTogc3RyaW5nO1xuICBASW5wdXQoXCJza3lwZUlkXCIpXG4gIHNreXBlOiBzdHJpbmc7XG4gIEBJbnB1dChcImdyYXZhdGFySWRcIilcbiAgZ3JhdmF0YXI6IHN0cmluZztcbiAgQElucHV0KFwiZ2l0aHViSWRcIilcbiAgZ2l0aHViOiBzdHJpbmc7XG4gIEBJbnB1dChcInNyY1wiKVxuICBjdXN0b206IHN0cmluZztcbiAgQElucHV0KFwibmFtZVwiKVxuICBpbml0aWFsczogc3RyaW5nO1xuICBASW5wdXQoXCJ2YWx1ZVwiKVxuICB2YWx1ZTogc3RyaW5nO1xuICBASW5wdXQoXCJwbGFjZWhvbGRlclwiKVxuICBwbGFjZWhvbGRlcjogc3RyaW5nO1xuICBASW5wdXQoXCJpbml0aWFsc1NpemVcIilcbiAgaW5pdGlhbHNTaXplOiBudW1iZXI7XG4gIEBPdXRwdXQoKVxuICBjbGlja09uQXZhdGFyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8vIGF2YXRhciBpbWcgc3JjXG4gIHB1YmxpYyBzcmM6IHN0cmluZztcbiAgLy8gYXZhdGFyIHRleHQgdmFsdWVcbiAgcHVibGljIGRhdGE6IHN0cmluZztcbiAgcHVibGljIGF2YXRhclN0eWxlOiBhbnkgPSB7fTtcbiAgcHVibGljIGhvc3RTdHlsZTogYW55ID0ge307XG5cbiAgcHJpdmF0ZSBfY3VycmVudFNvdXJjZSA9IDA7XG4gIHByaXZhdGUgX3NvdXJjZXM6IFNvdXJjZVtdID0gQXJyYXkoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwdWJsaWMgc291cmNlRmFjdG9yeTogU291cmNlRmFjdG9yeSxcbiAgICBwcml2YXRlIGF2YXRhclNlcnZpY2U6IEF2YXRhclNlcnZpY2VcbiAgKSB7IH1cblxuICAvLyBoYW5kbGUgY2xpY2sgZXZlbnRcbiAgaGFuZGxlQ2xpY2tFdmVudChldmVudDogYW55KSB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICB0aGlzLmNsaWNrT25BdmF0YXIuZW1pdCh0aGlzLl9zb3VyY2VzW3RoaXMuX2N1cnJlbnRTb3VyY2UgLSAxXSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCBpbnB1dHMgY2hhbmdlXG4gICAqXG4gICAqIHBhcmFtIHt7IFtwcm9wS2V5OiBzdHJpbmddOiBTaW1wbGVDaGFuZ2UgfX0gY2hhbmdlc1xuICAgKlxuICAgKiBtZW1iZXJvZiBBdmF0YXJDb21wb25lbnRcbiAgICovXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IHsgW3Byb3BLZXk6IHN0cmluZ106IFNpbXBsZUNoYW5nZSB9KSB7XG4gICAgZm9yIChjb25zdCBwcm9wTmFtZSBpbiBjaGFuZ2VzKSB7XG4gICAgICBpZiAodGhpcy5hdmF0YXJTZXJ2aWNlLmlzU291cmNlKHByb3BOYW1lKSkge1xuICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBjaGFuZ2VzW3Byb3BOYW1lXS5jdXJyZW50VmFsdWU7XG4gICAgICAgIHRoaXMuX2FkZFNvdXJjZShBdmF0YXJTb3VyY2VbcHJvcE5hbWUudG9VcHBlckNhc2UoKV0sIGN1cnJlbnRWYWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIHJlaW50aWFsaXplIHRoZSBhdmF0YXIgY29tcG9uZW50IHdoZW4gYSBzb3VyY2UgcHJvcGVydHkgdmFsdWUgaGFzIGNoYW5nZWRcbiAgICAvLyB0aGUgZmFsbGJhY2sgc3lzdGVtIG11c3QgYmUgcmUtaW52b2tlZCB3aXRoIHRoZSBuZXcgdmFsdWVzLlxuICAgIHRoaXMuX2luaXRpYWxpemVBdmF0YXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBhdmF0YXIgY29tcG9uZW50IGFuZCBpdHMgZmFsbGJhY2sgc3lzdGVtXG4gICAqL1xuICBfaW5pdGlhbGl6ZUF2YXRhcigpIHtcbiAgICB0aGlzLl9jdXJyZW50U291cmNlID0gMDtcbiAgICBpZiAodGhpcy5fc291cmNlcy5sZW5ndGggPiAwICYmIHRoaXMuX3NvdXJjZXNbdGhpcy5fY3VycmVudFNvdXJjZV0pIHtcbiAgICAgIC8vIE9yZGVyIHNvdXJjZXMgYXJyYXkgYnkgc291cmNlIHByaW9yaXR5XG4gICAgICB0aGlzLl9zb3VyY2VzLnNvcnQoKHNvdXJjZTEsIHNvdXJjZTIpID0+IHRoaXMuYXZhdGFyU2VydmljZS5jb3BtYXJlU291cmNlcyhzb3VyY2UxLnNvdXJjZVR5cGUsIHNvdXJjZTIuc291cmNlVHlwZSkpO1xuICAgICAgLy8gSG9zdCBzdHlsZVxuICAgICAgdGhpcy5ob3N0U3R5bGUgPSB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnNpemUgKyBcInB4XCIsXG4gICAgICAgIGhlaWdodDogdGhpcy5zaXplICsgXCJweFwiXG4gICAgICB9O1xuICAgICAgLy8gRmV0Y2ggYXZhdGFyIHNvdXJjZVxuICAgICAgdGhpcy5mZXRjaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhdmF0YXIgc291cmNlXG4gICAqXG4gICAqIHBhcmFtIHthbnl9IGV2ZW50XG4gICAqXG4gICAqIG1lbWJlck9mIEF2YXRhckNvbXBvbmVudFxuICAgKi9cbiAgZmV0Y2goZXZlbnQ/OiBhbnkpIHtcbiAgICBjb25zdCBhdmF0YXJTb3VyY2UgPSB0aGlzLl9zb3VyY2VzW3RoaXMuX2N1cnJlbnRTb3VyY2VdO1xuICAgIGlmICghYXZhdGFyU291cmNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0aGlzLmF2YXRhclNlcnZpY2UuaXNUZXh0QXZhdGFyKGF2YXRhclNvdXJjZS5zb3VyY2VUeXBlKSkge1xuICAgICAgdGhpcy5kYXRhID0gYXZhdGFyU291cmNlLmdldEF2YXRhcih0aGlzLmluaXRpYWxzU2l6ZSk7XG4gICAgICB0aGlzLnNyYyA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuYXZhdGFyU3R5bGUgPSB0aGlzLl9pbml0aWFsc1N0eWxlKGF2YXRhclNvdXJjZS5zb3VyY2VJZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXZhdGFyU3R5bGUgPSB0aGlzLl9pbWFnZVN0eWxlKCk7XG4gICAgICBpZiAoYXZhdGFyU291cmNlIGluc3RhbmNlb2YgQXN5bmNTb3VyY2UpIHtcbiAgICAgICAgdGhpcy5fZmV0Y2hBc3luY0F2YXRhcihhdmF0YXJTb3VyY2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcmMgPSBhdmF0YXJTb3VyY2UuZ2V0QXZhdGFyKHRoaXMuc2l6ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX2N1cnJlbnRTb3VyY2UrKztcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiByZXR1cm5zIGluaXRpYWxzIHN0eWxlXG4gICAqXG4gICAqIG1lbWJlck9mIEF2YXRhckNvbXBvbmVudFxuICAgKi9cbiAgX2luaXRpYWxzU3R5bGUoYXZhdGFyVmFsdWU6IHN0cmluZykge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXG4gICAgICBib3JkZXJSYWRpdXM6IHRoaXMucm91bmQgPyBcIjEwMCVcIiA6IHRoaXMuY29ybmVyUmFkaXVzICsgXCJweFwiLFxuICAgICAgYm9yZGVyOiB0aGlzLmJvcmRlckNvbG9yID8gXCIxcHggc29saWQgXCIgKyB0aGlzLmJvcmRlckNvbG9yIDogXCJcIixcbiAgICAgIHRleHRUcmFuc2Zvcm06IFwidXBwZXJjYXNlXCIsXG4gICAgICBjb2xvcjogdGhpcy5mZ0NvbG9yLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLmJnQ29sb3JcbiAgICAgICAgPyB0aGlzLmJnQ29sb3JcbiAgICAgICAgOiB0aGlzLmF2YXRhclNlcnZpY2UuZ2V0UmFuZG9tQ29sb3IoYXZhdGFyVmFsdWUpLFxuICAgICAgZm9udDpcbiAgICAgICAgTWF0aC5mbG9vcih0aGlzLnNpemUgLyB0aGlzLnRleHRTaXplUmF0aW8pICtcbiAgICAgICAgXCJweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmXCIsXG4gICAgICBsaW5lSGVpZ2h0OiB0aGlzLnNpemUgKyBcInB4XCIsXG4gICAgICAuLi50aGlzLnN0eWxlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiByZXR1cm5zIGltYWdlIHN0eWxlXG4gICAqXG4gICAqIG1lbWJlck9mIEF2YXRhckNvbXBvbmVudFxuICAgKi9cbiAgX2ltYWdlU3R5bGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1heFdpZHRoOiBcIjEwMCVcIixcbiAgICAgIGJvcmRlclJhZGl1czogdGhpcy5yb3VuZCA/IFwiNTAlXCIgOiB0aGlzLmNvcm5lclJhZGl1cyArIFwicHhcIixcbiAgICAgIGJvcmRlcjogdGhpcy5ib3JkZXJDb2xvciA/IFwiMXB4IHNvbGlkIFwiICsgdGhpcy5ib3JkZXJDb2xvciA6IFwiXCIsXG4gICAgICB3aWR0aDogdGhpcy5zaXplLFxuICAgICAgaGVpZ2h0OiB0aGlzLnNpemUsXG4gICAgICAuLi50aGlzLnN0eWxlXG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRmV0Y2ggYXZhdGFyIGltYWdlIGFzeW5jaHJvdW5zbHkuXG4gICAqXG4gICAqIHBhcmFtIHtTb3VyY2V9IHNvdXJjZSByZXByZXNlbnRzIGF2YXRhciBzb3VyY2VcbiAgICogbWVtYmVyb2YgQXZhdGFyQ29tcG9uZW50XG4gICAqL1xuICBfZmV0Y2hBc3luY0F2YXRhcihzb3VyY2U6IEFzeW5jU291cmNlKSB7XG4gICAgdGhpcy5hdmF0YXJTZXJ2aWNlLmZldGNoQXZhdGFyKHNvdXJjZS5nZXRBdmF0YXIoKSkuc3Vic2NyaWJlKFxuICAgICAgZGF0YSA9PiB7XG4gICAgICAgIC8vIGV4dHJhY3QgYXZhdGFyIGltYWdlIGZyb20gdGhlIHJlc3BvbnNlIGRhdGFcbiAgICAgICAgdGhpcy5zcmMgPSBzb3VyY2UucHJvY2Vzc1Jlc3BvbnNlKGRhdGEsIHRoaXMuc2l6ZSk7XG4gICAgICB9LFxuICAgICAgZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBgbmd4LWF2YXRhcjogZXJyb3Igd2hpbGUgZmV0Y2hpbmcgJHtzb3VyY2Uuc291cmNlVHlwZX0gYXZhdGFyIGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhdmF0YXIgc291cmNlXG4gICAqXG4gICAqIHBhcmFtIHNvdXJjZVR5cGUgYXZhdGFyIHNvdXJjZSB0eXBlIGUuZyBmYWNlYm9vayx0d2l0dGVyLCBldGMuXG4gICAqIHBhcmFtIHNvdXJjZVZhbHVlICBzb3VyY2UgdmFsdWUgZS5nIGZhY2Vib29rSWQgdmFsdWUsIGV0Yy5cbiAgICovXG4gIF9hZGRTb3VyY2Uoc291cmNlVHlwZTogQXZhdGFyU291cmNlLCBzb3VyY2VWYWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHNvdXJjZVZhbHVlKSB7XG4gICAgICBpZiAoIXRoaXMuX3VwZGF0ZUV4aXN0aW5nU291cmNlKHNvdXJjZVR5cGUsIHNvdXJjZVZhbHVlKSkge1xuICAgICAgICB0aGlzLl9zb3VyY2VzLnB1c2goXG4gICAgICAgICAgdGhpcy5zb3VyY2VGYWN0b3J5Lm5ld0luc3RhbmNlKHNvdXJjZVR5cGUsIHNvdXJjZVZhbHVlKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogVGhpcyBtZXRob2QgY2hlY2sgd2V0aGVyIGFuIGF2YXRhciBzb3VyY2UgaGFzIGJlZW4gYWRkZWQuIElmIHNvXG4gICAqIHRoZSBzb3VyY2UgdmFsdWUgd2lsbCBiZSB1cGRhdGVkIHdpdGggdGhlIG5ldyB2YWx1ZSBwYXNzZWQgYXNcbiAgICogcGFyYW1hdGVyLlxuICAgKiBJdCByZXR1cm5zIHRydWUgaWYgdGhlIHNvdXJjZSBleGlzdHMgYW5kIHVwZGF0ZSBoYXMgYmVlbiBwZXJmb3JtZWQsXG4gICAqIHJldHVybnMgZmFsc2UgaWYgdGhlIHNvdXJjZSB3YXMgbm90IGZvdW5kXG4gICAqXG4gICAqIHBhcmFtIHtzdHJpbmd9IHNvdXJjZVR5cGUgdGhlIHR5cGUgb2YgdGhlIHNvdXJjZVxuICAgKiBwYXJhbSB7c3RyaW5nfSBzb3VyY2VWYWx1ZSB0aGUgbmV3IHZhbHVlIG9mIHRoZSBzb3VyY2VcbiAgICpcbiAgICogbWVtYmVyb2YgQXZhdGFyQ29tcG9uZW50XG4gICAqL1xuICBfdXBkYXRlRXhpc3RpbmdTb3VyY2Uoc291cmNlVHlwZTogc3RyaW5nLCBzb3VyY2VWYWx1ZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc291cmNlSW5kZXggPSB0aGlzLl9zb3VyY2VzLmZpbmRJbmRleChcbiAgICAgIHNvdXJjZSA9PiBzb3VyY2Uuc291cmNlVHlwZSA9PT0gc291cmNlVHlwZS50b1VwcGVyQ2FzZSgpXG4gICAgKTtcbiAgICBpZiAoc291cmNlSW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5fc291cmNlc1tzb3VyY2VJbmRleF0uc291cmNlSWQgPSBzb3VyY2VWYWx1ZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiJdfQ==